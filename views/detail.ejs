<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/main.css">
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" crossorigin="anonymous"></script>
</head>
<body>
  <script>    
    Kakao.init('2008a212248e102d2bfe8b0a90121f85'); 
    Kakao.isInitialized();
  </script>
    <%         
    const pageSize = 10; 
    const startIdx = (parseInt(currentPage) - 1)* pageSize;
    const totalPages = Math.ceil(parseInt(totalCount[0].totalCount) / pageSize);
    const startPage = Math.max(1, parseInt(currentPage) - 2);
    const endPage = Math.min(totalPages, parseInt(currentPage) + 2);

    function dateTime(dateString) {
      const date = new Date(dateString);
      const hours = String(date.getHours()).padStart(2, '0'); // ì‹œê°„ì€ ë‘ ìë¦¬ë¡œ í¬ë§·
      const minutes = String(date.getMinutes()).padStart(2, '0'); // ë¶„ì€ ë‘ ìë¦¬ë¡œ í¬ë§·
      return `${hours}:${minutes}`;
    }

    %>  
    <%-include('header.ejs') %>
    <div class="main-page px-5">
        <table class="detailTable">
            <thead>
              <tr>
                <td colspan="4" class="fs-3 fw-bold">
                  <%= list[0].corp%>                     
                  <a id="kakaotalk-sharing-btn"href="javascript:;">
                    <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" class="kakao_icon" alt="ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë³´ë‚´ê¸° ë²„íŠ¼" />
                  </a>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">id</th>
                <td><%= list[0].id%></td>
                <th scope="row">íšŒì‚¬ëª…</th>
                <td><%= list[0].corp%></td>
              </tr>
              <tr>
                <th scope="row">ì„¤ë¦½ì¼</th>
                <td><%= formatDate(list[0].date)%></td>
                <th scope="row">ì·¨ì„ì¼</th>
                <td><%= formatDate(list[0].eDate)%></td>
              </tr>
              <tr>
                <th scope="row">ë‹´ë‹¹ì</th>
                <td><%= list[0].manager%></td>
                <th scope="row">ì—°ë½ì²˜</th>
                <td><%= list[0].phone%></td>
              </tr>
              <tr>
                <th scope="row">ì´ë©”ì¼</th>
                <td><%= list[0].email%></td>
              </tr>
              <tr>
                <th scope="row">ê°ì‚¬</th>
                <td><%= list[0].auditor == '1' ? 'ìˆìŒ': 'ì—†ìŒ'%></td>
                <th scope="row">ê²°ì‚°</th>
                <td><%= list[0].closing%>ì›”</td>
              </tr>
              <tr>
                <th scope="row">ì´ì‚¬ì„ê¸°</th>
                <td class= "<%= isDatePastTwoMonth(formatDate(list[0].directorTerm)) ? 'alertRed' : ''  %> ">
                  <%= formatDate(list[0].directorTerm)%>
                  <%= isDatePastTwoWeek(list[0].directorTerm) ? '(20ì¼ë„ ì•ˆ ë‚¨ì•˜ì–´ìš”ğŸ˜¢)' : isDatePastOneMonth(list[0].directorTerm) ? '(í•œë‹¬ í›„ ë§Œë£Œ)' : isDatePastTwoMonth(list[0].directorTerm) ? '(ë‘ë‹¬ í›„ ë§Œë£Œ)' :'' %>
                </td>
                <th scope="row">ê°ì‚¬ì„ê¸°</th>
                <td class= "<%= isDatePastTwoMonth(formatDate(list[0].auditorTerm)) ? 'alertRed' : ''  %> ">
                  <%= formatDate(list[0].auditorTerm)%>
                  <%= isDatePastTwoWeek(list[0].auditorTerm) ? '(20ì¼ë„ ì•ˆ ë‚¨ì•˜ì–´ìš”ğŸ˜¢)' : isDatePastOneMonth(list[0].auditorTerm) ? '(í•œë‹¬ í›„ ë§Œë£Œ)' : isDatePastTwoMonth(list[0].auditorTerm) ? '(ë‘ë‹¬ í›„ ë§Œë£Œ)' :'' %>
                </td>
              </tr>
              <tr>
                <th scope="row">ë¹„ê³ </th> 
                <td><%= list[0].memo ? list[0].memo.replaceAll(" ", "&nbsp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll("\n", "<br>") : ''%></td>
              </tr>
            </tbody>
          </table>
          <div class="my-3"><strong>ìƒë‹´ì‘ì„±</strong>
            <div class="pb-2 mb-1 small lh-sm border-bottom"></div>
            <form action="/makeComment?id=<%= list[0].id%>" method="post" class="row gy-2 gx-3 align-items-center">
                <div class="col-auto bottom input-small"> ìƒë‹´ë°©ë²• : <input type="text" name="contact" class="form-control" required></div>
                <div class="col-auto">ìƒë‹´ë‚ ì§œ : <input type="date" name="date" class="form-control" required></div>
                <div class="col-auto">ìƒë‹´ì‹œê°„ : <input type="time" name="time" class="form-control"></div>
                <div class="col-auto"> ìƒë‹´ì§ì› : <input type="text" name="user" class="form-control" placeholder="ìƒë‹´í•œ ì§ì› ì´ë¦„" value="<%= locals.userName%>" required></div>
                <div class="col-auto"> ì œëª© : <input type="text" name="title" class="form-control" placeholder="ê°„ëµí•œ ë‚´ìš©" required></div>                    
                <div class="col-auto">ë©”ëª¨ : <br><textarea name="memo" class="form-control" cols="30" rows="1" placeholder="ì„¸ë¶€ ë‚´ìš©"></textarea></div>
                <div class="col-auto bottom"><button class="btn btn-outline-secondary">ì œì¶œ</button></div>
            </form>
          </div>
          <strong>ìƒë‹´ê¸°ë¡</strong>
          <div class="pb-2 mb-1 small lh-sm border-bottom"></div>

          <% for (let i = startIdx; i < Math.min(startIdx + pageSize, commentLists.length); i++) { 
            let x = i % pageSize;
            %>
            <div class="row gy-2 gx-3 align-items-center d-flex align-items-center">
              <div class="col-auto input-small"><input type="text" name="contact" class="form-control" value="<%-commentLists[i].contact%>" required></div>
              <div class="col-auto"><input type="date" name="date" class="form-control" value="<%-formatDate(commentLists[i].date)%>" readonly></div>
              <div class="col-auto"><input type="time" name="time" class="form-control" value="<%-dateTime(commentLists[i].date)%>" readonly></div>
              <div class="col-auto input-small"><input type="text" name="user" class="form-control" placeholder="ìƒë‹´í•œ ì§ì› ì´ë¦„" value="<%-commentLists[i].user%>" readonly></div>
              <div class="col-auto"><input type="text" name="title" class="form-control" placeholder="ê°„ëµí•œ ë‚´ìš©" value="<%-commentLists[i].title%>"  readonly></div>                    
              <div class="col-90"><textarea name="memo" class="form-control" cols="30" rows="1" placeholder="ì„¸ë¶€ ë‚´ìš©" readonly><%-commentLists[i].memo%></textarea></div>
              <div class="col-auto bottom"><a onclick=toggleDiv(<%=x%>)>ìˆ˜ì •</a></div>
              <div class="col-auto bottom"><a href='/commentDelete?id=<%= commentLists[i].commentId %>&corpid=<%=id%>' onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')">ì‚­ì œ</a></div>
            </div>
            <div class="updateForm" style="display: none;">
              <form action="/updateComment?id=<%= commentLists[i].commentId%>&corpid=<%=id%>" method="post" class="row gy-2 gx-3 align-items-center">
                  <div class="col-auto bottom input-small"> ìƒë‹´ë°©ë²• :
                      <input type="text" name="contact" class="form-control" value="<%-commentLists[i].contact%>" required>
                  </div>
                  <div class="col-auto">ìƒë‹´ë‚ ì§œ : <input type="date" name="date" class="form-control" value="<%-formatDate(commentLists[i].date)%>" required></div>
                  <div class="col-auto">ìƒë‹´ì‹œê°„ : <input type="time" name="time" class="form-control" value="<%-dateTime(commentLists[i].date)%>"></div>
                  <div class="col-auto input-small"> ìƒë‹´ì§ì› : <input type="text" name="user" class="form-control" placeholder="ìƒë‹´í•œ ì§ì› ì´ë¦„" value="<%-commentLists[i].user%>" required></div>
                  <div class="col-auto"> ì œëª© : <input type="text" name="title" class="form-control" placeholder="ê°„ëµí•œ ë‚´ìš©" value="<%-commentLists[i].title%>" required></div>                    
                  <div class="col-auto">ë©”ëª¨ : <br><textarea name="memo" class="form-control" cols="30" rows="1" placeholder="ì„¸ë¶€ ë‚´ìš©"><%-commentLists[i].memo%></textarea></div>
                  <div class="col-auto bottom"><button class="btn btn-outline-secondary">ì œì¶œ</button></div>
              </form>
              <div class="mb-3"></div>
            </div>
            <% }
              %>              
        <nav class="d-flex justify-content-center p-3">
          <ul class="pagination">
                  <li class="page-item <%= currentPage > 1 ? '' : 'disabled' %> "><a class="page-link" href="/detail/<%-id%>?currentPage=1">ì²˜ìŒ</a></li>
                  <li class="page-item <%= currentPage > 1 ? '' : 'disabled' %> "><a class="page-link" href="/detail/<%-id%>?currentPage=<%- (parseInt(currentPage) - 1) %>">ì´ì „ </a></li>
              <% for (let i = startPage; i <= endPage; i++) { %>
                  <li class="page-item <%= i === parseInt(currentPage) ? 'active' : '' %>""><a class="page-link" href="/detail/<%-id%>?currentPage=<%= i %>"><%= i %></a></li>
              <% } %>
                  <li class="page-item <%= currentPage < totalPages ? '' : 'disabled' %>"><a class="page-link" href="/detail/<%-id%>?currentPage=<%- (parseInt(currentPage) + 1) %>">ë‹¤ìŒ</a></li>
                  <li class="page-item <%= currentPage < totalPages ? '' : 'disabled' %>"><a class="page-link" href="/detail/<%-id%>?currentPage=<%- parseInt(totalPages) %>">ë</a></li>
          </ul>
      </nav>
      <div class="d-flex justify-content-end px-1">
        <button class="btn btn-outline-secondary" onclick = "location.href = '/detail'">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
    <%-include('footer.ejs') %>
    <script>       
       function toggleDiv(num) {            
            const div = document.getElementsByClassName('updateForm')[num];
            div.style.display === "none" ? div.style.display = "table-row" : div.style.display = "none";
        }
        
        let auditorTerm = '';
        if(`<%= list[0].auditor %>` == '1'){
          auditorTerm = 'ê°ì‚¬ì„ê¸° ë§Œë£Œì¼ : <%= formatDate(list[0].auditorTerm)%>';
        }

      Kakao.Share.createDefaultButton({
        container: '#kakaotalk-sharing-btn',
        objectType: 'text',
        text:
          `ì•ˆë…•í•˜ì„¸ìš”, í•´í”¼ë¸Œë¦¿ì§€ ì…ë‹ˆë‹¤. <%= list[0].corp%>ì˜ ì„ê¸°ë§Œë£Œ ì•ˆë‚´ì°¨ ì—°ë½ë“œë ¸ìŠµë‹ˆë‹¤. ì´ì‚¬ì„ê¸° ë§Œë£Œì¼ : <%= formatDate(list[0].directorTerm)%> ${auditorTerm} ì„ê¸°ì—°ì¥ ë¬¸ì˜ì‚¬í•­ì€ í•˜ë‹¨ ë§í¬ë¥¼ í†µí•´ ì—°ë½ì£¼ì„¸ìš”.`,
        link: {
          // [ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜] > [í”Œë«í¼] ì—ì„œ ë“±ë¡í•œ ì‚¬ì´íŠ¸ ë„ë©”ì¸ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
          mobileWebUrl: 'http://localhost:3000/',
          webUrl: 'http://localhost:3000/',
        },
      });
    </script>
</body>
</html>